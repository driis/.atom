var _ = require('lodash');
var path_1 = require('path');
var glob = require('glob');
var primaryFilesToSearch = ['global.json', '*.sln', '*.csx'];
var secondaryFilesToSearch = ['project.json', '*.csproj'];
function findProject(location, logger) {
    location = _.trimRight(location, path_1.sep);
    var locations = location.split(path_1.sep);
    var mappedLocations = locations.map(function (loc, index) {
        return _.take(locations, index + 1).join(path_1.sep);
    });
    mappedLocations.reverse();
    var primaryResult = searchForFolder(mappedLocations, primaryFilesToSearch, logger);
    if (primaryResult) {
        return primaryResult;
    }
    var secondaryResult = searchForFolder(mappedLocations, secondaryFilesToSearch, logger);
    if (secondaryResult) {
        return secondaryResult;
    }
    return null;
}
exports.findProject = findProject;
function searchForFolder(locations, filesToSearch, logger) {
    var foundFile;
    var results = locations.map(function (location) { return ({
        location: location,
        files: filesToSearch.map(function (fileName) { return path_1.join(location, fileName); })
    }); });
    _.each(results, function (_a) {
        var location = _a.location, files = _a.files;
        logger.log("Omnisharp Project Finder: Searching " + location + " for " + filesToSearch);
        var found = _.find(files, function (file) {
            var g = glob.sync(file);
            if (g && g.length) {
                return true;
            }
            return false;
        });
        if (found) {
            foundFile = found;
            logger.log("Omnisharp Project Finder: Found " + found);
            return false;
        }
    });
    if (foundFile) {
        return path_1.dirname(foundFile);
    }
}
