var enums_1 = require("../lib/enums");
var client_v2_1 = require("../lib/clients/client-v2");
describe("Omnisharp Server", function () {
    it("must construct", function () {
        new client_v2_1.ClientV2({
            projectPath: process.cwd()
        });
    });
    it("must construct with a specific driver", function () {
        new client_v2_1.ClientV2({
            driver: enums_1.Driver.Stdio,
            projectPath: process.cwd()
        });
    });
    describe('state', function () {
        this.timeout(20000);
        var server;
        before(function (done) {
            server = new client_v2_1.ClientV2({
                driver: enums_1.Driver.Stdio,
                projectPath: process.cwd()
            });
            server.connect();
            var sub = server.state.subscribe(function (state) {
                if (state === enums_1.DriverState.Connected) {
                    sub.dispose();
                    done();
                }
            });
        });
        it("must respond to all requests", function (done) {
            var count = 4;
            server.observeCheckalivestatus.subscribe(function (data) {
                count--;
                if (!count)
                    done();
            });
            server.checkalivestatus();
            server.checkalivestatus();
            server.checkalivestatus();
            server.checkalivestatus();
        });
        it("must give status", function (done) {
            var sub = server.status.delay(1).subscribe(function (status) {
                sub.dispose();
                done();
            });
            server.checkalivestatus();
            server.checkalivestatus();
        });
    });
});
